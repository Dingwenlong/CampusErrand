# 逻辑链路及对应测试说明报告

## 1. 说明
- 报告日期：2026-02-12
- 项目路径：`D:\Devs\PaoTui`
- 目标：给出系统核心业务链路、对应测试方式、执行结果与当前结论。

## 2. 端到端业务链路

### 链路 A：管理端登录与鉴权
1. 管理员在 `Login` 页面提交账号密码。
2. 前端调用 `/admin/login` 获取 token。
3. token 写入本地并进入受保护路由。
4. 请求拦截器附带 `Authorization: Bearer <token>`。
5. 后端拦截器校验 JWT，写入 `UserContext`。

验证项：
- 构建级：管理端登录页与路由、请求层全部通过 TS 构建。
- 代码级：`request` 返回结构统一为 `{code,message,data}`，错误路径可被页面消费。

结果：通过（构建及类型验证通过）。

### 链路 B：用户钱包密码设置/校验
1. 用户设置支付密码。
2. 后端通过 `MD5Util.encrypt` 存储密文。
3. 支付前通过 `MD5Util.verify` 校验输入密码。

验证项：
- 单元测试覆盖空值、空串、正确密码匹配。

结果：通过（`MD5UtilTest` 3/3 通过）。

### 链路 C：任务发布与资金冻结
1. 发布任务时校验支付密码。
2. 计算总金额（赏金+附加费）。
3. 检查余额并冻结金额。
4. 创建任务并记录交易流水。

验证项：
- 代码级审查发布逻辑与事务边界。
- 异常处理统一收敛到 `GlobalExceptionHandler`。

结果：通过静态逻辑检查；需联调环境执行真实数据库事务验证。

### 链路 D：任务大厅列表筛选
1. 前端按状态/类型请求任务列表。
2. 后端根据状态参数查询任务。

修复前问题：
- 状态参数被忽略，固定只查待接单。

修复后验证：
- 单元测试 `TaskServiceImplTest` 验证状态解析逻辑（默认 0，传参优先）。

结果：通过（2/2 通过）。

### 链路 E：任务取消、送达、收货、结算
1. 发单者/跑腿员发起取消（不同规则）。
2. 任务进入送达、收货后触发结算。
3. 冻结金额解冻/扣减，跑腿员收入入账，流水更新。

验证项：
- 代码级审查状态流转与事务逻辑。
- 运行级：编译与构建通过，异常统一返回。

结果：通过静态逻辑检查；需联调环境做资金一致性对账测试。

### 链路 F：评价与信用分
1. 仅任务参与方可评价。
2. 同任务同评价者只能评价一次。
3. 评分驱动信用分增减并限制区间 0-100。

验证项：
- 代码级审查权限、幂等、评分分值变更。

结果：逻辑可用；需联调环境补充真实数据回归。

### 链路 G：后台管理（任务/用户/钱包/评价/配置）
1. 管理端页面请求后台接口。
2. 后台分页、统计、状态更新返回统一结构。
3. 前端表格和图表渲染。

验证项：
- 管理端 `npm run build` 全量通过。
- 后端 `mvn test`、`mvn package` 通过。

结果：通过。

## 3. 测试执行矩阵

| 编号 | 类型 | 执行命令/方式 | 结果 |
|---|---|---|---|
| T1 | 后端单元测试 | `mvn test` | 通过 |
| T2 | 后端打包 | `mvn -DskipTests package` | 通过 |
| T3 | 管理端构建 | `cd campus-errand-admin && npm run build` | 通过 |
| T4 | Uniapp 构建 | `cd campus-errand-uniapp && npm run build` | 通过（有 Sass 弃用告警） |
| T5 | 异常返回一致性 | 新增 `GlobalExceptionHandler` + `GlobalExceptionHandlerTest` | 通过 |
| T6 | 任务状态筛选修复验证 | `TaskServiceImplTest` | 通过 |
| T7 | 密码校验边界验证 | `MD5UtilTest` | 通过 |

## 4. 当前可交付判断
- 构建层面：后端、管理端、Uniapp 均可产出可运行构建物。
- 代码质量层面：本轮已修复阻塞性问题和关键逻辑缺陷，并增加回归测试。
- 业务链路层面：核心链路已完成静态/单元级验证。

结论：
- 当前版本可进入“联调验收阶段”的交付状态。
- 上线前仍建议补齐真实环境端到端联测（MySQL/Redis/微信能力）。

## 5. 后续建议测试（上线前）
- 资金一致性专项：发布-取消-结算三类链路逐条核对余额、冻结、流水。
- 并发抢单测试：同任务并发接单压测（含 Redis 锁超时与重入场景）。
- 鉴权安全测试：过期 token、伪造 token、无 token 场景全覆盖。
- 前端性能测试：管理端大图表页面首屏与分包优化评估。
