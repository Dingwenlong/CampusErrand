# 一条龙启动脚本说明

## 目标
- 自动拉起 Docker 依赖（MySQL/Redis）
- 自动检测并安装后端/API 与前端后台依赖
- 自动编译 Uniapp 为微信小程序
- 自动启动后端 API 与后台管理项目（API 在 `campus-errand-api` 模块目录执行 `mvn spring-boot:run`）

## 脚本
- 启动：`scripts/one-click-start.ps1`
- 停止：`scripts/one-click-stop.ps1`
- 双击入口（Windows）：`scripts/one-click-start.bat`、`scripts/one-click-stop.bat`

## 使用方式（PowerShell）

### 1. 全流程一条龙（推荐）
```powershell
pwsh -ExecutionPolicy Bypass -File .\scripts\one-click-start.ps1
```

### 2. 仅做环境准备，不启动服务
```powershell
pwsh -ExecutionPolicy Bypass -File .\scripts\one-click-start.ps1 -SkipStart
```

### 3. 跳过 Docker（使用本机已有 MySQL/Redis）
```powershell
pwsh -ExecutionPolicy Bypass -File .\scripts\one-click-start.ps1 -SkipDocker
```

### 4. 跳过小程序编译
```powershell
pwsh -ExecutionPolicy Bypass -File .\scripts\one-click-start.ps1 -SkipUniBuild
```

### 5. 停止服务与容器
```powershell
pwsh -ExecutionPolicy Bypass -File .\scripts\one-click-stop.ps1
```

## 双击运行（.bat）

### 启动（双击）
- 双击：`scripts/one-click-start.bat`
- 默认会在成功后保留窗口并显示接口地址（API/后台管理），便于复制。

### 停止（双击）
- 双击：`scripts/one-click-stop.bat`

### 通过命令行传参（可选）
```bat
scripts\one-click-start.bat -SkipDocker
scripts\one-click-start.bat -SkipUniBuild
scripts\one-click-start.bat -SkipStart
```

## 默认端口
- API：`8080`
- 后台管理：`3000`
- MySQL：优先 `3306`（占用时自动切到 `33306`）
- Redis：优先 `6379`（占用时自动切到 `36379`）

脚本会把实际端口和启动 PID 写入：`.run/one-click-state.json`。

## 启动窗口行为
- `one-click-start.ps1` 启动 API 与后台管理时，默认以“最小化窗口”启动，不抢占前台。
