# 校园跑腿系统项目报告（测试与交付）

## 1. 报告信息
- 项目：`D:\Devs\PaoTui`
- 报告日期：2026-02-12
- 覆盖范围：
  - 后端：`campus-errand-common`、`campus-errand-api`
  - 管理端：`campus-errand-admin`
  - 小程序/H5：`campus-errand-uniapp`

## 2. 本轮执行内容
- 建立基线并执行首轮构建/测试，识别阻塞问题。
- 修复管理端 TypeScript 构建错误（路径别名、类型声明、路由类型、请求返回类型）。
- 修复后端任务列表状态筛选逻辑（状态参数生效）。
- 增加后端全局异常处理，统一业务异常返回结构，避免直接 500 页面。
- 修复 `MD5Util.verify` 在空字符串输入下的空指针风险。
- 新增并通过单元测试，完成回归构建验证。

## 3. 关键问题与修复

### 3.1 管理端构建失败
- 现象：`npm run build` 出现大量 TS2307/TS2339 报错，无法产出构建物。
- 原因：
  - 缺少 `@/*` 路径映射与 Vue 模块声明文件。
  - `request` 实际返回 `{code,message,data}`，类型系统按 `AxiosResponse` 推断，导致页面层类型不匹配。
  - `Sidebar` 组件重复导入 `defineProps/defineEmits`。
- 修复：
  - 更新 `campus-errand-admin/tsconfig.app.json`
  - 新增 `campus-errand-admin/src/env.d.ts`
  - 更新 `campus-errand-admin/src/utils/request.ts`
  - 更新 `campus-errand-admin/src/router/index.ts`
  - 更新 `campus-errand-admin/src/components/Sidebar/index.vue`
- 结果：管理端 `npm run build` 通过。

### 3.2 后端任务列表状态筛选无效
- 现象：任务列表接口无论传入何种 `status`，都只返回待接单任务。
- 根因：`TaskServiceImpl#getTaskList` 固定筛选 `status=0`，忽略传参。
- 修复：
  - 更新 `campus-errand-api/src/main/java/com/campus/errand/service/impl/TaskServiceImpl.java`
  - 增加 `resolveTaskListStatus` 并补充单测。
- 结果：状态参数行为与接口预期一致（传参优先，未传默认 0）。

### 3.3 业务异常未统一处理
- 现象：服务层大量 `RuntimeException`，缺少全局异常处理，存在直接 500 风险。
- 修复：
  - 新增 `campus-errand-api/src/main/java/com/campus/errand/handler/GlobalExceptionHandler.java`
  - 覆盖 `MethodArgumentNotValidException`、`ConstraintViolationException`、`RuntimeException`、`Exception`。
- 结果：异常统一输出 `Result` 结构，前端可稳定消费错误信息。

### 3.4 密码校验边界风险
- 现象：`MD5Util.verify("", "...")` 可能触发空指针。
- 修复：
  - 更新 `campus-errand-common/src/main/java/com/campus/errand/util/MD5Util.java`
  - 新增单测 `campus-errand-common/src/test/java/com/campus/errand/util/MD5UtilTest.java`
- 结果：空输入稳定返回 `false`。

### 3.5 JDK 25 测试执行兼容问题
- 现象：Surefire fork 子进程异常退出（classpath URL check）。
- 修复：
  - 更新根 `pom.xml` 中 `maven-surefire-plugin` 配置（`forkCount=0` 与 JVM 参数）。
- 结果：`mvn test` 可稳定执行。

## 4. 验证结果
- 后端测试：`mvn test` 通过（`campus-errand-common` + `campus-errand-api`）。
- 后端打包：`mvn -DskipTests package` 通过。
- 管理端构建：`campus-errand-admin` 下 `npm run build` 通过。
- Uniapp 构建：`campus-errand-uniapp` 下 `npm run build` 通过（存在 Sass 弃用警告，不影响当前构建产物）。

## 5. 交付结论
- 当前代码状态已达到“可构建、可回归、可继续联调”的交付标准。
- 已修复本轮检测出的核心阻塞项与高风险缺陷。
- 需在真实联调环境（MySQL/Redis/微信端）继续执行接口级和端到端联测，以完成上线前最终验收。

## 6. 遗留风险与建议
- `campus-errand-uniapp` 存在 Sass 旧语法弃用告警，建议后续批量迁移为 `@use`。
- 管理端构建产物中存在大体积 chunk 告警，建议按路由/图表做拆包优化。
- 仓库内已有未提交变更：`campus-errand-admin/src/views/Login/index.vue`（本次未覆盖其业务改动，合并前建议复核）。

## 7. 本轮变更文件
- `pom.xml`
- `campus-errand-common/pom.xml`
- `campus-errand-common/src/main/java/com/campus/errand/util/MD5Util.java`
- `campus-errand-common/src/test/java/com/campus/errand/util/MD5UtilTest.java`
- `campus-errand-api/src/main/java/com/campus/errand/service/impl/TaskServiceImpl.java`
- `campus-errand-api/src/main/java/com/campus/errand/handler/GlobalExceptionHandler.java`
- `campus-errand-api/src/test/java/com/campus/errand/handler/GlobalExceptionHandlerTest.java`
- `campus-errand-api/src/test/java/com/campus/errand/service/impl/TaskServiceImplTest.java`
- `campus-errand-admin/tsconfig.app.json`
- `campus-errand-admin/src/env.d.ts`
- `campus-errand-admin/src/router/index.ts`
- `campus-errand-admin/src/utils/request.ts`
- `campus-errand-admin/src/components/Sidebar/index.vue`
